<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../favicon.ico">
        

	<title>Data Storage - jsPsych</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">jsPsych</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Introduction</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../tutorials/hello-world/">The Basics: Hello World</a>
                        </li>
                    
                        <li >
                            <a href="../../tutorials/go-nogo-task/">Demo Experiment: Simple Reaction Time Task</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Core Library API <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../core_library/overview/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../core_library/jspsych-core/">jsPsych core</a>
                        </li>
                    
                        <li >
                            <a href="../../core_library/jspsych-data/">jsPsych.data</a>
                        </li>
                    
                        <li >
                            <a href="../../core_library/jspsych-randomization/">jsPsych.randomization</a>
                        </li>
                    
                        <li >
                            <a href="../../core_library/jspsych-turk/">jsPsych.turk</a>
                        </li>
                    
                        <li >
                            <a href="../../core_library/jspsych-pluginAPI/">jsPsych.pluginAPI</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Plugins <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../plugins/overview/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/creating-a-plugin/">Creating a New Plugin</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-animation/">jspsych-animation</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-call-function/">jspsych-call-function</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-categorize/">jspsych-categorize</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-categorize-animation/">jspsych-categorize-animation</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-free-sort/">jspsych-free-sort</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-html/">jspsych-html</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-instructions/">jspsych-instructions</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-multi-stim-multi-response/">jspsych-multi-stim-multi-response</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-palmer/">jspsych-palmer</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-reconstruction/">jspsych-reconstruction</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-same-different/">jspsych-same-different</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-similarity/">jspsych-similarity</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-single-audio/">jspsych-single-audio</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-single-stim/">jspsych-single-stim</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-survey-likert/">jspsych-survey-likert</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-survey-text/">jspsych-survey-text</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-text/">jspsych-text</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-visual-search-circle/">jspsych-visual-search-circle</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-vsl-animate-occlusion/">jspsych-vsl-animate-occlusion</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-vsl-grid-scene/">jspsych-vsl-grid-scene</a>
                        </li>
                    
                        <li >
                            <a href="../../plugins/jspsych-xab/">jspsych-xab</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Features <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../chunks-blocks-trials/">Creating an Experiment: Chunks, Blocks, & Trials</a>
                        </li>
                    
                        <li >
                            <a href="../progress-bar/">Automatic Progress Bar</a>
                        </li>
                    
                        <li >
                            <a href="../mturk/">Integrating with Mechanical Turk</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Data Storage</a>
                        </li>
                    
                        <li >
                            <a href="../randomization-repetition/">Randomization & Repetition</a>
                        </li>
                    
                        <li >
                            <a href="../functions-as-parameters/">Using Functions as Plugin Parameters</a>
                        </li>
                    
                        <li >
                            <a href="../callbacks/">Event-related Callback Functions</a>
                        </li>
                    
                        <li >
                            <a href="../image-preloading/">Image Preloading</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../support/">Support</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../about/about/">About jsPsych</a>
                        </li>
                    
                        <li >
                            <a href="../../about/license/">License</a>
                        </li>
                    
                        <li >
                            <a href="../../about/contributing/">Contributing to jsPsych</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../mturk/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../randomization-repetition/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/jodeleeuw/jsPsych">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#data-storage">Data Storage</a></li>
        
            <li><a href="#storing-data-in-jspsychs-data-structure">Storing data in jsPsych's data structure</a></li>
        
            <li><a href="#storing-data-permanently-as-a-file">Storing data permanently as a file</a></li>
        
            <li><a href="#storing-data-permanently-in-a-mysql-database">Storing data permanently in a MySQL database</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="data-storage">Data Storage</h1>
<p>There are two very different kinds of data storage: data stored in <em>memory</em> and data stored <em>permanently</em>. Data stored permanently exists even after the browser running jsPsych closes, typically in a database or in a file on a web server. Data stored in memory exists only as long the browser window running jsPsych is open.</p>
<p>jsPsych has many features for interacting with data stored in <em>memory</em>, but relatively few for <em>permanent</em> data storage. This is a deliberate choice, mainly because there are dozens of ways that data could be stored permanently and this strategy avoids locking in one particular solution. However, saving data permanently is obviously a crucial component of any experiment, and this page contains a few suggestions on how to accomplish permanent data storage.</p>
<h2 id="storing-data-in-jspsychs-data-structure">Storing data in jsPsych's data structure</h2>
<p>jsPsych has a centralized array of data that is filled in as the experiment runs. Each trial adds an entry to this array, and you can access the content of the array with various functions, including <code>jsPsych.data.getData()</code>, which returns the entire contents of jsPsych's data array.</p>
<p>In many cases, data collection will essentially be automatic and hidden. Plugins save data without any specific intervention, so it is not uncommon to have the only interaction with the data be at the end of the experiment when it is time to save it in a more permanent manner (see sections below about how to do this). However, there are some situations in which you may want to interact with the data; in particular, you may want to store additional data that the plugins are not recording, like a subject identifier or condition assignment. You may also want to add data on a trial by trial basis; for example, in a Stroop paradigm you would want to label which trials are congruent and which are incongruent. These scenarios are explored below.</p>
<h3 id="adding-data-to-all-trials">Adding data to all trials</h3>
<p>Often it is useful to add a piece of data to <em>all</em> of the trials in the experiment. For example, appending the subject ID to each trial. This can be done easily with the <code>jsPsych.addProperties</code> function. Here is an example:</p>
<pre><code>// generate a random subject ID
var subject_id = Math.floor(Math.random()*100000);

// pick a random condition for the subject at the start of the experiment
var condition_assignment = jsPsych.randomization.sample(['conditionA', 'conditionB', 'conditionC'],1);

// record the condition assignment in the jsPsych data
// this adds a property called 'subject' and a property called 'condition' to every trial
jsPsych.addProperties({
  subject: subject_id,
  condition: condition_assignment
});
</code></pre>

<h3 id="adding-data-to-a-particular-trial-or-block">Adding data to a particular trial or block</h3>
<p>Data can be added to a particular trial by setting the <code>data</code> parameter for the trial. The <code>data</code> parameter is an object of key-value pairs, and each pair is added to the data for that trial.</p>
<pre><code>var trial = {
  type: 'single-stim',
  stimuli: ['imgA.jpg'],
  data: { image_type: 'A' }
}
</code></pre>

<p>If you have multiple trials defined in the same block, then the data is added to each trial:</p>
<pre><code>var block = {
  type: 'single-stim',
  stimuli: ['imgA1.jpg', 'imgA2.jpg', 'imgA3.jpg'],
  data: { image_type: 'A' }
}
</code></pre>

<p>However, if you specify an array for the data parameter that has the same length as the number of trials in the block, then the data is recorded individually for each trial:</p>
<pre><code>var block = {
  type: 'single-stim',
  stimuli: ['imgA1.jpg', 'imgB1.jpg', 'imgC1.jpg'],
  data: [{ image_type: 'A' }, { image_type: 'B' }, { image_type: 'C' }]
}
</code></pre>

<h3 id="adding-data-to-a-chunk-of-trials">Adding data to a chunk of trials</h3>
<p>Data can be added at the chunk level as well. This can be useful to indicate different portions of the experiment, such as a training and test.</p>
<pre><code>var training_chunk = {
  chunk_type: 'linear',
  timeline: [training_trials],
  data: {phase: 'training'}
}

var test_chunk = {
  chunk_type: 'linear',
  timeline: [test_trials],
  data: {phase: 'test'}
}
</code></pre>

<h2 id="storing-data-permanently-as-a-file">Storing data permanently as a file</h2>
<p>This is one of the simplest methods for saving jsPsych data on the server that is running the experiment. It involves a short PHP script and a few lines of JavaScript code. This method will save each participant's data as a CSV file on the server. <strong>This method will only work if you are running on a web server with PHP installed, or a local server with PHP (e.g. <a href="https://www.apachefriends.org/index.html">XAMPP</a>).</strong></p>
<p>This method uses a simple PHP script to write files to the server:</p>
<pre><code class="php">&lt;?php
// the $_POST[] array will contain the passed in filename and data
// the directory &quot;data&quot; is writable by the server (chmod 777)
$filename = &quot;data/&quot;.$_POST['filename'];
$data = $_POST['filedata'];
// write the file to disk
file_put_contents($filename, $data);
?&gt;
</code></pre>

<p>The <code>file_put_contents($filename, $data)</code> method requires permission to write new files. An easy way to solve this is to create a directory on the server that will store the data and use the chmod command to give all users write permission (chmod 777) to that directory. In the above example, I append the directory <code>data/</code> to the filename, and that directory is writable.</p>
<p>To use the PHP script, the JavaScript that runs jsPsych needs to send the filename and filedata information. jQuery has an easy to use method that enables JavaScript&lt;-&gt;PHP communication. Here's an example:</p>
<pre><code class="javascript">function saveData(filename, filedata){
   $.ajax({
      type:'post',
      cache: false,
      url: 'save_data.php', // this is the path to the above PHP script
      data: {filename: filename, filedata: filedata}
   });
}

// call the saveData function after the experiment is over
jsPsych.init({

   // code to define the experiment structure would go here...

   on_finish: function(data){ saveData(&quot;filename.csv&quot;, jsPsych.data.dataAsCSV()) }
});
</code></pre>

<p>To use this in an actual experiment, it would be important to tie the filename to some unique identifier like a subject number.</p>
<h2 id="storing-data-permanently-in-a-mysql-database">Storing data permanently in a MySQL database</h2>
<p>The ideal solution for storing data generated by jsPsych is to write it to a database.</p>
<p>There are dozens of database options. MySQL is one of the most popular <a href="http://en.wikipedia.org/wiki/Relational_database">relational databases</a>, is free to use, and relatively easy <a href="https://www.google.com/search?q=how+to+install+mysql">to install</a>. This page will assume that you have a MySQL database installed on your server that is hosting the jsPsych experiment, and that your server is able to execute PHP code. If you are trying to run on a local machine, you'll need to install a local server environment like <a href="https://www.apachefriends.org/index.html">XAMPP</a>.</p>
<h3 id="step-1">Step 1</h3>
<p>To communicate with a MySQL database, you will need a server-side script, such as a PHP script. The following script should work for all jsPsych data. Copy the code below into a PHP file and give it an appropriate name (e.g. savedata.php). Put the PHP file on your server in a convenient location. <strong>This script will only work with jsPsych version 4.0 and later.</strong></p>
<pre><code class="php">&lt;?php

// Submit Data to mySQL database
// Josh de Leeuw

// Edit this line to include your database connection script
//
//  The script you link should contain the following two lines:
//
//  $dbc = mysql_connect('localhost', 'username', 'password');
//  mysql_select_db('databasename', $dbc);
//
include('database_connect.php');

// You should not need to edit below this line

function mysql_insert($table, $inserts) {
    $values = array_map('mysql_real_escape_string', array_values($inserts));
    $keys = array_keys($inserts);

    return mysql_query('INSERT INTO `'.$table.'` (`'.implode('`,`', $keys).'`) VALUES (\''.implode('\',\'', $values).'\')');
}

// get the table name
$tab = $_POST['table'];

// decode the data object from json
$trials = json_decode($_POST['json']);

// get the optional data (decode as array)
$opt_data = json_decode($_POST['opt_data'], true);
$opt_data_names = array_keys($opt_data);

var_dump($trials);

// for each element in the trials array, insert the row into the mysql table
for($i=0;$i&lt;count($trials);$i++)
{
    $to_insert = (array)($trials[$i]);
    // add any optional, static parameters that got passed in (like subject id or condition)
    for($j=0;$j&lt;count($opt_data_names);$j++){
        $to_insert[$opt_data_names[$j]] = $opt_data[$opt_data_names[$j]];
    }
    $result = mysql_insert($tab, $to_insert);
}

// confirm the results
if (!$result) {
    die('Invalid query: ' . mysql_error());
} else {
    print &quot;successful insert!&quot;;
}

?&gt;
</code></pre>

<h3 id="step-2">Step 2</h3>
<p>To use the above PHP script, you'll need to provide the credentials for your MySQL database. The PHP script is expecting the credentials to be stored in a separate PHP file called 'database_connect.php', located in the same directory as the PHP script. This file should look like:</p>
<pre><code class="php">&lt;?php

$dbc = mysql_connect('localhost', 'username', 'password');
mysql_select_db('databasename', $dbc);

?&gt;
</code></pre>

<p>Replace the username and password strings with your database credentials, and replace the databasename string with the name of the database you are connecting to. For example, if my username is 'josh', my password is 'abc123', and the database is 'myresearch' then the file should look like:</p>
<pre><code class="php">&lt;?php

$dbc = mysql_connect('localhost', 'josh', 'abc123');
mysql_select_db('myresearch', $dbc);

?&gt;
</code></pre>

<h3 id="step-3">Step 3</h3>
<p>To use this PHP script, you need to invoke it from JavaScript code within your experiment page. Here's an example of how to do that.</p>
<pre><code class="javascript">// data parameter should be either the value of jsPsych.data()
// or the parameter that is passed to the on_data_update callback function for the core library
// jsPsych.data() contains ALL data
// the callback function will contain only the most recently written data.
function save_data(data){
   var data_table = &quot;my_experiment_table&quot;; // change this for different experiments
   $.ajax({
      type:'post',
      cache: false,
      url: 'path/to_php/file.php', // change this to point to your php file.
      // opt_data is to add additional values to every row, like a subject ID
      // replace 'key' with the column name, and 'value' with the value.
      data: {
          table: data_table,
          json: JSON.stringify(data),
          opt_data: {key: value}
      },
      success: function(output) { console.log(output); } // write the result to javascript console
   });
}
</code></pre>

<p>Note that you'll need to change the script above to reference the table in your mysql database that will store the data, the path to the PHP file created in step 1, and change the opt_data line to include any data you want to append to the table, such as a subject ID (or remove this line entirely if you have no additional data).</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
        <script src="../../js/extra.js"></script>
        <script src="../../js/analytics.js"></script>
    </body>
</html>